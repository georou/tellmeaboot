<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Client to NVR Isolated CCTV with VLAN and a Virtual Machine - Tell Me Aboot</title>
  <meta name="description" content="Installing NVR software is a bit of a blackbox. In this post, we&rsquo;re going to isolate the software, network and NVR via a VLAN and use the software in a Virtual Machine that has a separate dedicated interface to that VLAN.">
  <meta name="author" content="georou"/><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "Tell Me Aboot",
    
    "url": "https:\/\/georou.github.io\/tellmeaboot"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/georou.github.io\/tellmeaboot"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/georou.github.io\/tellmeaboot",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/georou.github.io\/tellmeaboot\/post\/2021\/client-to-nvr-isolated-cctv\/",
          "name": "Client to nvr isolated cctv with VLAN and a virtual machine"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "georou"
  },
  "headline": "Client to NVR Isolated CCTV with VLAN and a Virtual Machine",
  "description" : "Installing NVR software is a bit of a blackbox. In this post, we\u0026rsquo;re going to isolate the software, network and NVR via a VLAN and use the software in a Virtual Machine that has a separate dedicated interface to that VLAN.\n",
  "inLanguage" : "en",
  "wordCount":  604 ,
  "datePublished" : "2021-11-11T21:33:43",
  "dateModified" : "2021-11-11T21:33:43",
  "image" : "https:\/\/georou.github.io\/tellmeaboot\/NeoneBay.jpg",
  "keywords" : [ "Security, Networking" ],
  "mainEntityOfPage" : "https:\/\/georou.github.io\/tellmeaboot\/post\/2021\/client-to-nvr-isolated-cctv\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/georou.github.io\/tellmeaboot",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/georou.github.io\/tellmeaboot\/NeoneBay.jpg",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>

<meta property="og:title" content="Client to NVR Isolated CCTV with VLAN and a Virtual Machine" />
<meta property="og:description" content="Installing NVR software is a bit of a blackbox. In this post, we&rsquo;re going to isolate the software, network and NVR via a VLAN and use the software in a Virtual Machine that has a separate dedicated interface to that VLAN.">
<meta property="og:image" content="https://georou.github.io/tellmeaboot/NeoneBay.jpg" />
<meta property="og:url" content="https://georou.github.io/tellmeaboot/post/2021/client-to-nvr-isolated-cctv/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="Tell Me Aboot" />

  <meta name="twitter:title" content="Client to NVR Isolated CCTV with VLAN and a Virtual Machine" />
  <meta name="twitter:description" content="Installing NVR software is a bit of a blackbox. In this post, we&rsquo;re going to isolate the software, network and NVR via a VLAN and use the software in a Virtual Machine that has a separate â€¦">
  <meta name="twitter:image" content="https://georou.github.io/tellmeaboot/NeoneBay.jpg" />
  <meta name="twitter:card" content="summary_large_image" />
  <link href='https://georou.github.io/tellmeaboot/favicon.ico' rel='icon' type='image/x-icon'/>
  <meta name="generator" content="Hugo 0.118.2">
  <link rel="alternate" href="https://georou.github.io/tellmeaboot/index.xml" type="application/rss+xml" title="Tell Me Aboot"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><link rel="stylesheet" href="https://georou.github.io/tellmeaboot/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="https://georou.github.io/tellmeaboot/css/highlight.min.css" /><link rel="stylesheet" href="https://georou.github.io/tellmeaboot/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">

  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://georou.github.io/tellmeaboot">Tell Me Aboot</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Blog" href="https://georou.github.io/tellmeaboot/">Blog</a>
            </li>
          
        
          
            <li>
              <a title="Tags" href="https://georou.github.io/tellmeaboot/tags">Tags</a>
            </li>
          
        
          
            <li>
              <a title="About" href="https://georou.github.io/tellmeaboot/page/about/">About</a>
            </li>
          
        
          
            <li>
              <a title="Archives" href="https://georou.github.io/tellmeaboot/post">Archives</a>
            </li>
          
        

        

        
      </ul>
    </div>

    
      <div class="avatar-container">
        <div class="avatar-img-border">
          <a title="Tell Me Aboot" href="https://georou.github.io/tellmeaboot">
            <img class="avatar-img" src="https://georou.github.io/tellmeaboot/NeoneBay.jpg" alt="Tell Me Aboot" />
          </a>
        </div>
      </div>
    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              
                <h1>Client to NVR Isolated CCTV with VLAN and a Virtual Machine</h1>
              
              
              
              
                <span class="post-meta">
  
  
  <i class="fas fa-calendar"></i>&nbsp;Posted on November 11, 2021
  
  
    &nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;3&nbsp;minutes
  
  
    &nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;604&nbsp;words
  
  
  
</span>


              
            </div>
          </div>
        </div>
      </div>
    </div>
  
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <p>Installing NVR software is a bit of a blackbox. In this post, we&rsquo;re going to isolate the software, network and NVR via a VLAN and use the software in a Virtual Machine that has a separate dedicated interface to that VLAN.</p>
<p>To preface this, the software is Hikvision&rsquo;s iVMS.</p>
<p>Firstly, if you&rsquo;re the lucky one that has a motherboard that supports VLAN tagging, you can skip installing a dedicated network card. One PC has an Intel I211-AT, once installing the Intel Advanced network drivers allows VLAN tagging to be setup. How ever the other PC does not.</p>
<h1 id="the-breakdown">The Breakdown</h1>
<p><img src="https://georou.github.io/tellmeaboot/images/cctv-vlan-diagram.jpg" alt="cctv-vlan"></p>
<p>Going from the diagram, with this setup we achieve:</p>
<ul>
<li>Not installing the blackbox software directly onto the users everyday PC with sensitive files</li>
<li>NVR is isolated from the rest of the network via VLAN and firewall</li>
<li>NVR has restricted access to the internet via a firewall(pfSense)</li>
<li>NVR software can&rsquo;t leak footage to the internet</li>
<li>An expandable solution to also allow future computers to access the NVR via the VLAN</li>
</ul>
<p><strong>To begin:</strong></p>
<ol>
<li>Create a CCTV VLAN on the firewall and switches</li>
<li>Assign port on switch to the CCTV VLAN as an access port. Also assign the NVR&rsquo;s port too</li>
<li>Install NIC into PC and install drivers if needed</li>
<li>Set the interface metric to a high number for the NIC (crucial step if you&rsquo;re going to use DHCP)
<ol>
<li>Settings &gt; Change Adaptor Options &gt; Properties &gt; IPV4 &gt; Advanced(bottom) Un-tick Automatic Metric, enter a high number, 350</li>
</ol>
</li>
<li>Set either DHCP or a static IP. Is using static, make sure <strong>NOT</strong> to assign a gateway IP. Ok to save</li>
<li>Change Interface name to something descriptive. Eg: NVR Ethernet</li>
<li>Connect cable to PC&rsquo;s CCTV NIC we inserted earlier</li>
<li>Validate by pinging the CCTV&rsquo;s VLAN gateway IP address</li>
<li>Install VirtualBox or any other virtual machine software and install a Windows 10 guest VM. Update and install guest additions. Also download the iVMS software but don&rsquo;t install yet. <strong>Also a good idea to create a snapshot of the VM</strong></li>
<li>Once the Windows guest is updated, power off and reassign it&rsquo;s network card to the CCTV NIC as bridged</li>
<li>Power VM back on and validate it pulled the correct DHCP address and that it has no internet access</li>
<li>Connect NVR to the CCTV VLAN port earlier and validate it has the correct DHCP/Static address</li>
<li>Install iVMS software and configure connecting to the NVR</li>
<li>Optional, add shortcut link to desktop for starting the VM. Right click menu in VirtualBox, Create Shortcut on Desktop</li>
</ol>
<p>Hopefully that all goes smoothly. The only downside is Windows updates. You could try manually installing them via an offline method and then transferring the files to the VM from the host or destroy the VM every year or so and build it back up fresh with the latest updates. The threat surface is low keeping but it could still be a pivot point if a vulnerability in Windows is discovered. Again, should already be restricted access via firewall.</p>
<p>Similarly, if you want to export footage from the NVR, selecting the guest-to-host transfer and simply copy paste them or setup SCP/RDP in on the guest.</p>
<h1 id="troubleshooting-goofs">Troubleshooting goofs</h1>
<p>The reason for setting a high metric is because when the CCTV interface pulls a DHCP address from the router, it will contain a gateway IP. Having more than one default gateway on the PC will confuse it and break connections as it tries to send traffic alternating between the CCTV and LAN. The metric keeps all traffic flowing out the desired LAN interface. If you&rsquo;re using a static IP, just don&rsquo;t include a gateway since the NVR is in the same network.</p>

        
          <div class="blog-tags">
            
              <a href="https://georou.github.io/tellmeaboot/tags/security/">Security</a>&nbsp;
            
              <a href="https://georou.github.io/tellmeaboot/tags/networking/">Networking</a>&nbsp;
            
          </div>
        

        

        
          
            
          

          
                  <h4 class="see-also">See also</h4>
                  <ul>
                
                
                    <li><a href="https://georou.github.io/tellmeaboot/post/2022/juniper-ssh-preauth-error/">Juniper Switch SSH &#39;Expecting SSH2_MSG_KEX_ECDH_REPLY&#39; Error</a></li>
                
                    <li><a href="https://georou.github.io/tellmeaboot/post/2022/pfsense-ax88179-usb3-compatibility/">PfSense AX88179 vs RTL8153 USB 3 Ethernet Compatibility</a></li>
                
                    <li><a href="https://georou.github.io/tellmeaboot/post/2021/ubiquiti-ap-proxy-arp/">Ubiquiti AP Proxy ARP Disruption</a></li>
                
                    <li><a href="https://georou.github.io/tellmeaboot/post/2021/cisco-sg300-port-security-and-mac-filtering/">Cisco SG300 Port Security and Static Mac Filtering</a></li>
                
                    <li><a href="https://georou.github.io/tellmeaboot/post/2017/ip-camera-security-audit/">How To Access An IP Camera&#39;s Embedded Linux OS Through A Serial UART/TTL Port</a></li>
                
              </ul>

          
        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://georou.github.io/tellmeaboot/post/2021/ubiquiti-ap-proxy-arp/" data-toggle="tooltip" data-placement="top" title="Ubiquiti AP Proxy ARP Disruption">&larr; Previous Post</a>
            </li>
          
          
            <li class="next">
              <a href="https://georou.github.io/tellmeaboot/post/2022/pfsense-ax88179-usb3-compatibility/" data-toggle="tooltip" data-placement="top" title="PfSense AX88179 vs RTL8153 USB 3 Ethernet Compatibility">Next Post &rarr;</a>
            </li>
          
        </ul>
      


      

    </div>
  </div>
</div>

      
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
                <a href="https://github.com/georou" title="GitHub">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          <li>
            <a href="" title="RSS">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="credits copyright text-muted">
          
            
              <a href="tellmeaboot.com">georou</a>
            
          

          &nbsp;&bull;&nbsp;&copy;
          
            2017 - 2023
          

          
            &nbsp;&bull;&nbsp;
            <a href="https://georou.github.io/tellmeaboot">Tell Me Aboot</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="https://gohugo.io">Hugo v0.118.2</a> powered &nbsp;&bull;&nbsp; Theme <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> adapted from <a href="https://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a>
		  &nbsp;&bull;&nbsp; If you break anything because of reading here, that's on you.
          
        </p>
      </div>
    </div>
  </div>
</footer><script src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js" integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script src="https://georou.github.io/tellmeaboot/js/main.js"></script>
<script src="https://georou.github.io/tellmeaboot/js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script> $(document).ready(function() {$("pre.chroma").css("padding","0");}); </script><script> renderMathInElement(document.body); </script><script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script><script src="https://georou.github.io/tellmeaboot/js/load-photoswipe.js"></script>









    
  </body>
</html>

